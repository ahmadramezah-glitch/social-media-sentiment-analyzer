{% extends "base.html" %}

{% block title %}TikTok Analysis - Instagram Sentiment Analyzer{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h1 class="mb-2">
                        <i class="fab fa-tiktok text-primary"></i>
                        TikTok Analysis
                    </h1>
                    <p class="text-muted mb-0">Analyze TikTok videos by hashtag with video-to-text conversion and sentiment analysis</p>
                </div>
                <a href="{{ url_for('tiktok_video_analysis') }}" class="btn btn-outline-primary">
                    <i class="fas fa-video me-1"></i> Analyze Individual Video
                </a>
            </div>
        </div>
    </div>

    <!-- TikTok Search Form -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-search text-primary"></i> Search TikTok Hashtag</h5>
                </div>
                <div class="card-body">
                    <form method="POST" action="{{ url_for('tiktok_analysis') }}">
                        <div class="row g-3 align-items-end">
                            <div class="col-md-8">
                                <label for="hashtag" class="form-label">TikTok Hashtag:</label>
                                <div class="input-group">
                                    <span class="input-group-text">#</span>
                                    <input type="text" class="form-control" id="hashtag" name="hashtag" 
                                           placeholder="Enter hashtag (e.g., technology, fashion, food)" 
                                           value="{{ last_hashtag }}" required>
                                </div>
                                <div class="form-text">
                                    <i class="fas fa-info-circle"></i>
                                    This will search TikTok for videos with the specified hashtag, 
                                    convert video audio to text, and analyze sentiment (supports Arabic and English)
                                </div>
                            </div>
                            <div class="col-md-4">
                                <button type="submit" class="btn btn-primary btn-lg w-100">
                                    <i class="fab fa-tiktok"></i> Analyze TikTok Videos
                                </button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- TikTok Features Info -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-lightbulb text-warning"></i> TikTok Analysis Features</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <h6><i class="fas fa-video text-primary"></i> Video Processing:</h6>
                            <ul>
                                <li>Download TikTok videos by hashtag</li>
                                <li>Extract audio from video files</li>
                                <li>Convert speech to text (Speech-to-Text)</li>
                                <li>Support for multiple languages</li>
                            </ul>
                        </div>
                        <div class="col-md-6">
                            <h6><i class="fas fa-language text-success"></i> Language Support:</h6>
                            <ul>
                                <li><strong>Arabic:</strong> Full support with translation</li>
                                <li><strong>English:</strong> Native support</li>
                                <li><strong>Other languages:</strong> Auto-detection and translation</li>
                                <li>Automatic language detection</li>
                            </ul>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <h6><i class="fas fa-chart-line text-info"></i> Sentiment Analysis:</h6>
                            <ul>
                                <li>Analyze video content sentiment (positive/negative/neutral)</li>
                                <li>Calculate sentiment polarity scores</li>
                                <li>Store results in database for comparison</li>
                                <li>Generate insights and reports</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Recent TikTok Analysis Results -->
    {% if tiktok_posts %}
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-list text-primary"></i> Recent TikTok Analysis Results</h5>
                    <small class="text-muted">Showing {{ tiktok_posts|length }} analyzed videos</small>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for post in tiktok_posts %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card h-100 border-primary">
                                <div class="card-header bg-primary text-white">
                                    <h6 class="mb-0">
                                        <i class="fab fa-tiktok"></i> Video Analysis
                                    </h6>
                                </div>
                                <div class="card-body">
                                    <!-- Video Preview Placeholder -->
                                    <div class="text-center mb-3">
                                        <div class="bg-light border rounded p-4">
                                            <i class="fab fa-tiktok fa-3x text-primary mb-2"></i>
                                            <p class="mb-0 text-muted">Video Preview</p>
                                            {% if post.video_url %}
                                                <small class="text-muted">{{ post.video_url }}</small>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <!-- Caption -->
                                    <h6 class="card-title">Caption:</h6>
                                    <p class="card-text small">{{ post.caption[:100] if post.caption else 'No caption' }}{% if post.caption and post.caption|length > 100 %}...{% endif %}</p>
                                    
                                    <!-- Transcript -->
                                    {% if post.video_transcript %}
                                    <h6 class="card-title">Transcript:</h6>
                                    <p class="card-text small">{{ post.video_transcript[:150] }}{% if post.video_transcript|length > 150 %}...{% endif %}</p>
                                    {% endif %}
                                    
                                    <!-- Analysis Results -->
                                    <div class="row text-center">
                                        <div class="col-4">
                                            <div class="border rounded p-2">
                                                <small class="text-muted d-block">Sentiment</small>
                                                {% if post.sentiment == 'positive' %}
                                                    <span class="badge bg-success">Positive</span>
                                                {% elif post.sentiment == 'negative' %}
                                                    <span class="badge bg-danger">Negative</span>
                                                {% elif post.sentiment == 'neutral' %}
                                                    <span class="badge bg-secondary">Neutral</span>
                                                {% else %}
                                                    <span class="badge bg-warning">N/A</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="border rounded p-2">
                                                <small class="text-muted d-block">Score</small>
                                                {% if post.polarity %}
                                                    <span class="badge bg-primary">{{ "%.3f"|format(post.polarity) }}</span>
                                                {% else %}
                                                    <span class="text-muted">N/A</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                        <div class="col-4">
                                            <div class="border rounded p-2">
                                                <small class="text-muted d-block">Duration</small>
                                                {% if post.video_duration %}
                                                    <span class="badge bg-dark">{{ post.video_duration }}s</span>
                                                {% else %}
                                                    <span class="text-muted">N/A</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <!-- Metadata -->
                                    <div class="mt-3">
                                        <small class="text-muted">
                                            <i class="fas fa-hashtag"></i> #{{ post.hashtag }}<br>
                                            <i class="fas fa-clock"></i> {{ post.created_at.strftime('%Y-%m-%d %H:%M') if post.created_at else 'N/A' }}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% else %}
    <!-- No Results Message -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center">
                    <i class="fab fa-tiktok fa-3x text-muted mb-3"></i>
                    <h5 class="text-muted">No TikTok Videos Analyzed Yet</h5>
                    <p class="text-muted">Search for a hashtag above to start analyzing TikTok videos!</p>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- How It Works -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-cogs text-primary"></i> How TikTok Analysis Works</h5>
                </div>
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <i class="fas fa-search fa-2x text-primary mb-2"></i>
                                <h6>1. Search</h6>
                                <p class="mb-0">Search TikTok for videos with your hashtag</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <i class="fas fa-download fa-2x text-success mb-2"></i>
                                <h6>2. Download</h6>
                                <p class="mb-0">Download videos and extract audio</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <i class="fas fa-microphone fa-2x text-warning mb-2"></i>
                                <h6>3. Convert</h6>
                                <p class="mb-0">Convert speech to text using AI</p>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <div class="border rounded p-3">
                                <i class="fas fa-brain fa-2x text-info mb-2"></i>
                                <h6>4. Analyze</h6>
                                <p class="mb-0">Analyze sentiment and generate insights</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Technical Notes -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header">
                    <h5><i class="fas fa-info-circle text-info"></i> Technical Notes</h5>
                </div>
                <div class="card-body">
                    <div class="alert alert-info">
                        <h6><i class="fas fa-exclamation-triangle"></i> Important Information:</h6>
                        <ul class="mb-0">
                            <li><strong>API Access:</strong> This implementation uses a simplified approach. Real TikTok API access requires official developer credentials.</li>
                            <li><strong>Video Processing:</strong> Video-to-text conversion requires significant computational resources and may take time.</li>
                            <li><strong>Language Support:</strong> Supports Arabic, English, and other languages with automatic translation.</li>
                            <li><strong>Rate Limits:</strong> TikTok has strict rate limits. Please be patient during analysis.</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
